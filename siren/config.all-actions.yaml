name: siren-all-actions
description: Exercise every Siren action type in a single profile

ebpf:
    interface: wlp2s0
    drop_action_duration: 10s
    targets:
        - "ip:192.168.1.113"

rules:
    - name: log-ciao
      description: Log whenever CIAO appears but keep traffic flowing
      enabled: true
      priority: 90
      match:
          direction: both
          content_contains: "CIAO"
      action:
          type: log
          log:
              level: debug
              message: "CIAO observed in traffic"
              dump_payload: true

    - name: pass-healthchecks
      description: Explicitly allow lightweight ping checks
      enabled: true
      priority: 10
      match:
          direction: client_to_server
          content_starts_with: "PING"
      action:
          type: pass

    - name: drop-secrets
      description: Block packets that leak the SECRET marker
      enabled: true
      priority: 100
      match:
          direction: both
          content_contains: "SECRET"
      action:
          type: drop

    - name: delay-handshakes
      description: Introduce latency to suspicious handshake posts
      enabled: true
      priority: 70
      match:
          direction: client_to_server
          http_method: POST
          content_contains: "handshake"
      action:
          type: delay
          delay:
              duration: 350ms
              jitter: 100ms

    - name: modify-token
      description: Rewrite leaked tokens before they reach the server
      enabled: true
      priority: 80
      match:
          direction: client_to_server
          content_contains: "TOKEN=OLD"
      action:
          type: modify
          modify:
              operation: replace
              pattern: "TOKEN=OLD"
              replacement: "TOKEN=SANITIZED"

    - name: duplicate-alerts
      description: Send duplicate copies of ALERT responses for testing
      enabled: true
      priority: 60
      match:
          direction: server_to_client
          content_contains: "ALERT"
      action:
          type: duplicate
          duplicate:
              count: 2
              delay: 50ms

    - name: throttle-bulk
      description: Rate-limit large uploads to observe throttling
      enabled: true
      priority: 50
      match:
          direction: client_to_server
          size_gt: 512
      action:
          type: throttle
          throttle:
              rate: 20KB
              burst: 4KB

    - name: disconnect-malformed
      description: Force-close flows containing BADPROTO signature
      enabled: true
      priority: 95
      match:
          direction: both
          content_regex: "BADPROTO"
      action:
          type: disconnect
          disconnect:
              close_type: abrupt

    - name: chain-ciao-slowdrop
      description: Log, delay, then drop CIAO exfiltration attempts
      enabled: true
      priority: 110
      match:
          direction: client_to_server
          content_contains: "CIAO"
      action:
          type: chain
          chain:
              actions:
                  - type: log
                    log:
                        level: warn
                        message: "CIAO chain triggered"
                  - type: delay
                    delay:
                        duration: 200ms
                  - type: drop

recording:
    enabled: false
    output: siren-results/captures/all-actions.pcap
    format: pcap
    include_payload: true
    flush_interval: 2s
    max_file_size: 250MB
