id: "iot-standard"
version: "2.0.0"

name: "IoT Network Assessment"
description: |
    IoT Network Assessment - Connection-Aware Modules
    ==========================================

    This campaign uses V2 modules that receive connected conduit handles
    from the runner. The runner manages connection lifecycle (dial, TLS handshake, etc.)
    and modules focus purely on protocol logic.

    Key differences from V1:
    - Modules use api: 1 (V2)
    - Module receives conduit handle (not host:port)
    - Runner establishes connection based on conduit config
    - Modules use I/O callbacks (send/recv) instead of raw sockets
    - Simpler module code, better separation of concerns

runner:
    global_timeout: 60s
    max_parallel_targets: 16

scanner:
    open_only: true
    skip_host_discovery: false
    enable_udp: false
    service_detect:
        enabled: true
        version: "ALL"
    min_rate: 100
    timeout: 30m
    timing: T3
    ports:
        - "1883,8883,8083,8084,80,443,8000,8080,8443,8888,502,4840,554,8554,5672,5671,21,22,23,25,110,143,3128,3306,5432,6379,9002,9003"

attack_trees_def_path: "./campaigns/trees/iot.yaml"

steps:
    - id: "cert-inspect"
      required_tags: ["supports:tls", "protocol:tcp"]
      max_duration: 15s
      type: lib
      api: 0
      exec:
          abi:
              library_path: "./modules/kraken/abi/cert_inspect/target/release/libcert_inspect"
              symbol: "ORCA_Run"
          params:
              tls_insecure: true
              warn_days: 21
              min_rsa_bits: 4096
              allow_sha1: false
              disallow_self_signed: true
              print_certificates_stdout: true
              match_hostname: true
              require_san: true

    - id: "tls-version-check"
      required_tags: ["supports:tls", "protocol:tcp"]
      max_duration: 20s
      type: lib
      api: 0
      exec:
          abi:
              library_path: "./modules/kraken/abi/tls_version_check/build/tls_version_check"
              symbol: "ORCA_Run"

    - id: "telnet-default-creds"
      required_tags: ["protocol:tcp", "protocol:telnet"]
      max_duration: 20s
      type: lib
      api: 1
      exec:
          abi:
              library_path: "./modules/kraken/abi/telnel_default_creds/build/telnet_default_creds"
              symbol: "ORCA_Run_V2"
          conduit:
              kind: 1
              stack:
                  - name: tcp

    - id: "mqtt-auth-check"
      required_tags: ["protocol:mqtt"]
      max_duration: 15s
      type: lib
      api: 1
      exec:
          abi:
              library_path: "./modules/kraken/abi/mqtt_auth_check/build/mqtt_auth_check"
              symbol: "ORCA_Run_V2"
          conduit:
              kind: 1
              stack:
                  - name: tcp
          params:
              creds_file: "./credentialdbs/creds.txt"
