id: "iot-standard"
version: "1.0.0"

name: "IoT Network Assessment"
description: |
    README
    ======

    This plugin assess basic misconfigurations and possible known vulnerabilities in
    the protocols server in ICS environment.

    Each plugin will handle the connection and its execution on with its own logic,
    as you can see there are different types of plugins and each plugin is more or less
    complex.

    Some example of plugins are:
        - TLS version check: checks that the server only accept TLS >= 1.2,1.3
        - Default passowrd audit: checks that, if open, that telnet does not accept
            known passwords using a standard db.
        - MQTT auth check: checks that a broker does not accept anonymous users.
        - Cert inspection: checks that, if TLS is present, the used certificates are
            not self-signed, if mTLS is enforced, and other requirements specified
            with the params field.

    This campaign also include an attack tree file, where there are attack trees defined.
    Each attack tree is evaluated at the end of the campaign and its reported if the root
    is evaluated as true (i.e. an attacker objective is accomplished).

    This gives a better understanding of possible chain of attacks that could be used in the
    network.

    NOTE: NEVER use this campaign in a production environment as it will try some real known
    attacks that could lead to crashes in servers and production environment.

runner:
    global_timeout: 60s
    max_parallel_targets: 16

scanner:
    # only report open ports
    open_only: true
    # -Pn
    skip_host_discovery: false
    # To have a faster execution
    enable_udp: false

    # -sV (will slow a bit down)
    # Setting this to false will hinder the scanning and the services fingerprinting
    # makeing the tool less powerfull on the tests it can do. But it will be significantly
    # faster.
    #
    # Then the fast vs light version can be choosen depending on what has to be done.
    service_detect: true
    version_all: false
    version_light: true

    min_rate: 100
    timeout: 30m
    timing: T3
    ports:
        - "1883,8883,8083,8084,80,443,8000,8080,8443,8888,502,4840,554,8554,5672,5671,21,22,23,25,110,143,3128,3306,5432,6379,9002,9003"

attack_trees_def_path: "./campaigns/trees/mqtt.yaml"

steps:
    - plugin_id: "tls_version_check"
      required_tags: ["supports:tls", "protocol:tcp"]
      max_duration_s: 20
      exec:
          transport: abi
          abi:
              library: "./plugins/tls_version_check/build/tls_version_check"
              symbol: "ORCA_Run"

    - plugin_id: "default_password_audit"
      required_tags: ["protocol:tcp", "protocol:telnet"]
      max_duration_s: 20
      exec:
          transport: abi
          abi:
              library: "./plugins/telnet_default_creds/build/telnet_default_creds"
              symbol: "ORCA_Run"

    - plugin_id: "mqtt_auth_check"
      required_tags: ["protocol:mqtt"]
      exec:
          transport: abi
          abi:
              library: "./plugins/mqtt_auth_check/build/mqtt_auth_check"
              symbol: "ORCA_Run"
          params:
              creds_file: "./credentialdbs/creds.txt"

    - plugin_id: "cert_inspection"
      required_tags: ["supports:tls", "protocol:tcp"]
      max_duration_s: 15
      exec:
          transport: abi
          abi:
              library: "./plugins/cert_inspect/target/release/libcert_inspect"
              symbol: "ORCA_Run"
          params:
              tls_insecure: true
              warn_days: 21
              min_rsa_bits: 4096
              allow_sha1: false
              disallow_self_signed: true
              print_certificates_stdout: true
              match_hostname: true
              require_san: true
