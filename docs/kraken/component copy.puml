@startuml

!theme vibrant
skinparam linetype poly
skinparam roundcorner 20
skinparam stereotype {
  BackgroundColor<<campaign>> #F2C5A1
  BackgroundColor<<attack_trees>> #F2A1A1
  BackgroundColor<<report>> #A1F2B5
  BorderColor #5C5C5C
}
skinparam actor {
  BackgroundColor #A1B5F2
  BorderColor #5C5C5C
}
skinparam package {
  BackgroundColor #D9D9D9
  BorderColor #5C5C5C
}
skinparam component {
  BackgroundColor #F2E3A1
  BorderColor #5C5C5C
}
skinparam artifact {
  BackgroundColor #FFFFFF
  BorderColor #5C5C5C
}

title Kraken â€” Component Diagram

top to bottom direction

actor "Operator" as ACT

artifact "campaign.yaml" as CAMPAIGN_YAML <<campaign>>
artifact "attack_trees.yaml" as ATTACK_TREES_YAML <<attack_trees>>
artifact "report.json" as REPORT_JSON <<report>>

package "Kraken" as K {

  package "Configuration" as L1 {
    [YAML Parser] as PARSE
    interface ICampaign
    interface IAttackTrees
  }

  package "Scanning" as L2 {
    [Scanner] as SCN
    interface IScanner
    [Nmap Scanner] as SCN_NMAP <<implementation>>
    [Masscan Scanner] as SCN_MASSCAN <<implementation>>
  }

  package "Execution" as L3 {
    [Runner] as RUN
    interface IModuleExecutor
    interface IResults
    [Native Builtin Executor] as EXEC_NATIVE <<executor>>
    [ABI Module Executor] as EXEC_ABI <<executor>>
    [CLI Module Executor] as EXEC_CLI <<executor>>
    [Docker Module Executor] as EXEC_DOCKER <<executor>>
    [gRPC Module Executor] as EXEC_GRPC <<executor>>
  }

  package "Reporting" as L4 {
    [JSON Reporter] as REP_JSON <<reporter>>
    interface IReport
  }

  package "Attack Logic" as L5 {
    [Attack Tree Evaluator] as ATK
    interface IAttackReport
  }

  package "Logging" as L6 {
    [Logger] as LOG
  }
}

package "External Modules" as EXT {
  [ABI Module]  as MOD_ABI  <<module>>
  [gRPC Module] as MOD_GRPC  <<module>>
  [CLI Module]  as MOD_CLI  <<module>>
  [Docker Module] as MOD_DOCKER <<module>>
}

' Configuration
ACT --> CAMPAIGN_YAML : defines
ACT --> ATTACK_TREES_YAML : defines
CAMPAIGN_YAML --> PARSE
ATTACK_TREES_YAML --> PARSE
PARSE -right-() ICampaign
PARSE -right-() IAttackTrees

' Scanning
SCN --( ICampaign
SCN_NMAP .up.|> IScanner
SCN_MASSCAN .up.|> IScanner
SCN -left-() IScanner

' Execution
RUN --( ICampaign
RUN --( IScanner
RUN -left-() IResults
RUN --( IModuleExecutor
EXEC_NATIVE .up.|> IModuleExecutor
EXEC_ABI .up.|> IModuleExecutor
EXEC_CLI .up.|> IModuleExecutor
EXEC_DOCKER .up.|> IModuleExecutor
EXEC_GRPC .up.|> IModuleExecutor

' External Modules
EXEC_ABI --> MOD_ABI
EXEC_CLI --> MOD_CLI
EXEC_DOCKER --> MOD_DOCKER
EXEC_GRPC --> MOD_GRPC

' Reporting
REP_JSON --( IResults
REP_JSON -left-() IReport
REP_JSON --> REPORT_JSON : writes
ACT --( IReport

' Attack Logic
ATK --( IResults
ATK --( IAttackTrees
ATK -left-() IAttackReport
ACT --( IAttackReport

' Logging
LOG --> SCN
LOG --> RUN
LOG --> ATK

@enduml
