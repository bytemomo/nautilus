@startuml

!theme vibrant
skinparam linetype poly
skinparam roundcorner 20
skinparam stereotype {
  BackgroundColor<<campaign>> #F2C5A1
  BackgroundColor<<attack_trees>> #F2A1A1
  BackgroundColor<<report>> #A1F2B5
  BackgroundColor<<native_structure>> #E8E0FF
  BorderColor #5C5C5C
}
skinparam actor {
  BackgroundColor #A1B5F2
  BorderColor #5C5C5C
}
skinparam package {
  BackgroundColor #D9D9D9
  BorderColor #5C5C5C
}
skinparam component {
  BackgroundColor #F2E3A1
  BorderColor #5C5C5C
}
skinparam artifact {
  BackgroundColor #FFFFFF
  BorderColor #5C5C5C
}

title Kraken â€” Component Diagram

' top to bottom direction

actor "Operator" as ACT

package "Artificats" {
    artifact "campaign.yaml" as CAMPAIGN_YAML <<campaign>>
    artifact "attack_trees.yaml" as ATTACK_TREES_YAML <<attack_trees>>
    artifact "report.json" as REPORT_JSON <<report>>
}

package "Kraken" as K {

  package "Configuration" as CONF {
    [Campaign Model] as CAMP
    [Attack Tree Definitions] as TREE_DEF
    [Module Definitions] as MODDEF
  }

  package "Scanning & Classification" as SCAN {
    [Scanner Service] as SCN
    interface IScannerEngine
    [Nmap Engine] as SCN_NMAP <<implementation>>
  }

  package "Execution Orchestrator" as EXEC {
    [Runner] as RUNNER
    interface IModuleExecutor
    [Native Builtin Adapter] as EXEC_NATIVE <<adapter>>
    [ABI Module Adapter] as EXEC_ABI <<adapter>>
    [CLI Module Adapter] as EXEC_CLI <<adapter>>
    [Docker Module Adapter] as EXEC_DOCKER <<adapter>>
    [gRPC Module Adapter] as EXEC_GRPC <<adapter>>

    package "Native Builtins" as EXEC_NATIVE_PKG {
      [Native Registry] as REGISTRY
      interface INativeModule <<native_structure>>
      [Generic Native Module] as MOD_NATIVE_GENERIC <<native_structure>>
    }
  }

  package "Knowledge & Reporting" as KNOW {
    [Attack Tree Evaluator] as ATK
    [JSON Reporter] as REP_JSON <<reporter>>
  }

  package "IO & Serialization" as IO {
    [YAML Decoder] as YAML_DEC
    [JSON Encoder] as JSON_ENC
  }
}

package "External Modules" as EXT {
  [ABI Module]  as MOD_ABI  <<module>>
  [gRPC Module] as MOD_GRPC <<module>>
  [CLI Module]  as MOD_CLI  <<module>>
  [Docker Module] as MOD_DOCKER <<module>>
}

' Operator workflow
ACT --> CAMPAIGN_YAML : defines
ACT --> ATTACK_TREES_YAML : defines

' Configuration loading
CAMPAIGN_YAML --> YAML_DEC
ATTACK_TREES_YAML --> YAML_DEC
YAML_DEC --> CAMP
YAML_DEC --> MODDEF
YAML_DEC --> TREE_DEF
TREE_DEF --> ATK

' Scanner
CAMP --> SCN : scanner config
SCN --( IScannerEngine
SCN_NMAP .up.. IScannerEngine

' Runner orchestration
CAMP --> RUNNER : runner config + tasks
SCN --> RUNNER : classified targets
RUNNER --( IModuleExecutor
EXEC_NATIVE .up.. IModuleExecutor
EXEC_ABI .up.. IModuleExecutor
EXEC_CLI .up.. IModuleExecutor
EXEC_DOCKER .up.. IModuleExecutor
EXEC_GRPC .up.. IModuleExecutor
EXEC_NATIVE --> REGISTRY : lookup descriptor
REGISTRY --( INativeModule : exposes descriptors
MOD_NATIVE_GENERIC .up.. INativeModule

' External modules
EXEC_ABI --> MOD_ABI
EXEC_CLI --> MOD_CLI
EXEC_DOCKER --> MOD_DOCKER
EXEC_GRPC --> MOD_GRPC

' Reporting + attack trees
RUNNER --> REP_JSON : run results
REP_JSON --> JSON_ENC
JSON_ENC --> REPORT_JSON : writes
RUNNER --> ATK : findings
ATK --> ACT : alerts
ACT --( REPORT_JSON

@enduml
