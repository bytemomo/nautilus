# HARDENED PROFILE - ACL Configuration
#
# Implements principle of least privilege.
# Each user/device can only access topics they absolutely need.
# No anonymous access. $SYS restricted to admin.
#
# This configuration should result in NO ACL-related findings from Kraken.

# =============================================================================
# DENY ALL BY DEFAULT
# Mosquitto denies by default, but we make it explicit
# No rules without "user" prefix = no anonymous access
# =============================================================================

# =============================================================================
# Admin User - Full Access (for management only)
# =============================================================================
user admin
topic readwrite #
topic read $SYS/#
topic write $SYS/broker/connection/#

# =============================================================================
# SCADA User - Control Room Operations
# Strict access: telemetry read, commands write, alarms read
# =============================================================================
user scada
# Read telemetry from all devices
topic read ot/+/telemetry/#
# Write commands to devices (with acknowledgment read)
topic write ot/+/command/+
topic read ot/+/command/+/ack
# Read and acknowledge alarms
topic read ot/+/alarm/#
topic write ot/+/alarm/+/ack
# Read device status
topic read ot/+/status/online
# System health (not $SYS)
topic read system/health/#

# =============================================================================
# PLC User - PLC-01 Device Only
# Strict access: only its own topics
# =============================================================================
user plc
# Publish own telemetry
topic write ot/plc/telemetry/#
# Publish own status
topic write ot/plc/status/#
# Receive commands for this device only
topic read ot/plc/command/#
# Acknowledge commands
topic write ot/plc/command/+/ack
# Publish alarms
topic write ot/plc/alarm/#
# Read alarm acknowledgments
topic read ot/plc/alarm/+/ack

# =============================================================================
# RTU User - RTU-01 Device Only
# Strict access: only its own topics
# =============================================================================
user rtu
# Publish own telemetry
topic write ot/rtu/telemetry/#
# Publish own status
topic write ot/rtu/status/#
# Receive commands for this device only
topic read ot/rtu/command/#
# Acknowledge commands
topic write ot/rtu/command/+/ack
# Publish alarms
topic write ot/rtu/alarm/#
# Read alarm acknowledgments
topic read ot/rtu/alarm/+/ack

# =============================================================================
# Operator User - Read-Only Monitoring
# Can view but not control
# =============================================================================
user operator
# Read-only access to telemetry
topic read ot/+/telemetry/#
# Read-only access to status
topic read ot/+/status/#
# Read-only access to alarms
topic read ot/+/alarm/#
# System health monitoring
topic read system/health/#

# =============================================================================
# Guest User - Minimal Access
# Public information only
# =============================================================================
user guest
# Only public test topics
topic read test/public/#
# System health summary only
topic read system/health/summary

# =============================================================================
# NO $SYS ACCESS FOR NON-ADMIN USERS
# $SYS topics are not listed for any user except admin
# This prevents mqtt-sys-disclosure findings
# =============================================================================
