# INSECURE PROFILE - Mosquitto Configuration
# 
# This profile intentionally contains multiple security vulnerabilities
# for testing Kraken's detection capabilities:
#
# Vulnerabilities present:
# - MQTT-ANON: Anonymous access allowed on all listeners
# - MQTT-PUBSUB-ANON: No authentication required for pub/sub
# - MQTT-ACL-*: No ACL enforcement
# - mqtt-sys-disclosure: $SYS topic accessible to everyone
# - TLS-SUPPORT-OVERVIEW: Weak TLS (TLS 1.0/1.1 allowed)
# - No client certificate verification
#
# Expected Kraken findings: ALL security checks should fail

# =============================================================================
# Global Settings
# =============================================================================
persistence true
persistence_location /mosquitto/data/
log_dest stdout
log_type all

# VULNERABLE: No ACL file - everyone can access everything
# acl_file /mosquitto/config/acl.conf

# =============================================================================
# Listener 1: Plaintext MQTT (Port 1883)
# VULNERABLE: No encryption, anonymous access
# =============================================================================
listener 1883
protocol mqtt
allow_anonymous true

# =============================================================================
# Listener 2: TLS MQTT (Port 8883) - WEAK TLS
# VULNERABLE: Old TLS versions, no auth required, anonymous allowed
# =============================================================================
listener 8883
protocol mqtt
allow_anonymous true

# TLS Configuration - INTENTIONALLY WEAK
cafile /mosquitto/certs/ca.crt
certfile /mosquitto/certs/server.crt
keyfile /mosquitto/certs/server.key

# VULNERABLE: Allow TLS 1.2 (not enforcing TLS 1.3)
# Modern Mosquitto doesn't support TLS 1.0/1.1, so we use 1.2 as "weak"
tls_version tlsv1.2

# VULNERABLE: Weak ciphers allowed (includes CBC modes, SHA1)
ciphers DEFAULT:!aNULL:!eNULL

# =============================================================================
# Listener 3: mTLS Port (Port 8884) - BUT NO CLIENT CERT REQUIRED
# VULNERABLE: mTLS port but require_certificate is false
# =============================================================================
listener 8884
protocol mqtt
allow_anonymous true

cafile /mosquitto/certs/ca.crt
certfile /mosquitto/certs/server.crt
keyfile /mosquitto/certs/server.key

tls_version tlsv1.2

# VULNERABLE: Client certificates not required even on mTLS port
require_certificate false

# =============================================================================
# $SYS Topic Configuration
# VULNERABLE: $SYS topics exposed (default behavior when no ACL)
# =============================================================================
# sys_interval defaults to 10 seconds - exposes system information
